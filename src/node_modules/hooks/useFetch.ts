import { useCallback, useEffect, useState } from 'react'
import axios from 'axios'

const useFetch = (url: string): any => {
	const baseUrl = 'https://6291e81dcd0c91932b6a02b7.mockapi.io/api/v1/'
	const [isLoading, setIsLoading] = useState(false)
	const [response, setResponse] = useState(null)
	const [error, setError] = useState(null)
	const [options, setOptions] = useState({})

	const doFetch = useCallback((options: any) => {
		setOptions(options)
		setIsLoading(true)
	}, [])

	useEffect(() => {
		let skipGetResponseAfterDie = false
		const requestOptions = {
			...options,
		}
		if (!isLoading) {
			return
		}
		axios(baseUrl + url, requestOptions)
			.then((res) => {
				if (!skipGetResponseAfterDie) {
					setIsLoading(false)
					setResponse(res.data)
				}
			})
			.catch((error) => {
				if (!skipGetResponseAfterDie) {
					setIsLoading(false)
					setError(error.response.data)
				}
			})

		return () => {
			skipGetResponseAfterDie = true
		}
	}, [isLoading, options, url])

	return [{ isLoading, response, error }, doFetch]
}

export default useFetch
